{% extends "base.html" %}
{% load cms_tags sekizai_tags menu_tags %}
{% block search %}
    <div class="top_left_position">
        {% placeholder "infomation" %}
    </div>
    <div class="top_middle_hot_news">
        {% placeholder "hot news" %}

    </div>
{% endblock %}
{% block searchother %}
    <div class="top_right_under_search">
        {% placeholder "under search" %}
    </div>
{% endblock %}
{% block content %}
    {% placeholder "shortcuts" %}
    {% placeholder "content_left" %}
    {% placeholder "content_right" %}
    {% placeholder "content_footer" %}
{% endblock %}

{% block custom_js %}
    <script>
        String.format = function () {
            if (arguments.length == 0)
                return null;
            var str = arguments[0];
            for (var i = 1; i < arguments.length; i++) {
                var re = new RegExp('\\{' + (i - 1) + '\\}', 'gm');
                str = str.replace(re, arguments[i]);
            }
            return str;
        };
        $(function () {
            $("div[name='shortcut_placeholder']").each(function () {
                var div_item = $(this)
                $(this).text("");
                $.ajax({
                    url: "{% url lazy_load %}",
                    data: {id: $(this).attr("id"), default: $(this).attr("default")},
                    dataType: 'json',
                    success: function (json) {
                        div_item.text("");
                        for (var i = 0; i < json.length; i++) {
                            var content = json[i];
                            var style = "";
                            var today = new Date();
                            var create_date = new Date(Date.parse(content.create_date_display.replace(/-/g, "/")));
                            if (today - create_date < 86400000) {
                                style = "font-weight: bold";
                            }
                            var text = String.format('<li> <a target="_blank" class="page-item" title="{0}"' +
                                    ' href="/message/message/{1}/">' +
                                    '<div style="{3}">{2}</div>' +
                                    '</a> </li>', content.name, content.id, content.category_message_title_meta_display, style);
                            div_item.append(text)
                        }
                    },
                    beforeSend: function () {
                        div_item.append('<img style="margin-left:100px" src="{{ STATIC_URL }}img/index_loading.gif"  />');
                    }

                });

            })


        });
    </script>
{% endblock %}